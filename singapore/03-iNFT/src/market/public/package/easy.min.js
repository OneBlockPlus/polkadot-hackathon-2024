"use strict";window.Easy=(()=>{var M=Object.defineProperty;var Lr=Object.getOwnPropertyDescriptor;var Tr=Object.getOwnPropertyNames;var wr=Object.prototype.hasOwnProperty;var P=(e,n)=>()=>(e&&(n=e(e=0)),n);var I=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),S=(e,n)=>{for(var r in n)M(e,r,{get:n[r],enumerable:!0})},Nr=(e,n,r,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Tr(n))!wr.call(e,i)&&i!==r&&M(e,i,{get:()=>n[i],enumerable:!(t=Lr(n,i))||t.enumerable});return e};var R=e=>Nr(M({},"__esModule",{value:!0}),e);var J={};S(J,{codeType:()=>k,errorLevel:()=>Z,formatType:()=>Y,keysApp:()=>rr,rawType:()=>Q,relatedIndex:()=>nr});var Z,Q,Y,k,rr,nr,$=P(()=>{"use strict";Z=(t=>(t.ERROR="error",t.WARN="warning",t.UNEXCEPT="unexcept",t))(Z||{}),Q=(i=>(i.DATA="data",i.APP="app",i.LIB="lib",i.NONE="unknow",i))(Q||{}),Y=(u=>(u.JAVASCRIPT="js",u.CSS="css",u.MARKDOWN="md",u.JSON="json",u.MIX="mix",u.NONE="",u))(Y||{}),k=(i=>(i.ASCII="ascii",i.UTF8="utf8",i.HEX="hex",i.NONE="",i))(k||{}),rr=(e=>{})(rr||{}),nr=(l=>(l[l.AUTH=0]="AUTH",l[l.HIDE=1]="HIDE",l[l.TRUST=2]="TRUST",l[l.NAME=0]="NAME",l[l.BLOCK=1]="BLOCK",l))(nr||{});});var er={};S(er,{linkCreator:()=>Or,linkDecoder:()=>_r});var B,j,Or,_r,or=P(()=>{"use strict";B={check:!1,utf8:!0,pre:"anchor://"},j={getParams:e=>{let n={},r=e.split("&");for(let t=0;t<r.length;t++){let l=r[t].split("=");if(l.length!==2)return{error:"error parameter"};n[l[0]]=l[1]}return n},combineParams:e=>{if(!e)return"";let n=[];for(var r in e)n.push(`${r}=${e[r]}`);return n.length===0?"":n.join("&")}},Or=(e,n)=>{let r=j.combineParams(n);return Array.isArray(e)?e[1]!==0?`${B.pre}${e[0]}/${e[1]}${r&&"?"+r}`:`${B.pre}${e[0]}${r&&"?"+r}`:`${B.pre}${e}${r&&"?"+r}`},_r=e=>{let n={location:["",0]},r=e.toLocaleLowerCase(),t=B.pre;if(r.length<=t.length+1)return{error:"invalid string"};if(r.substring(0,t.length)!==t)return{error:"invalid protocol"};let l=r.substring(t.length,r.length),u=l.split("?");if(u.length>2)return{error:"error request, please check anchor name"};if(u.length!==1){let c=j.getParams(u[1]);if(c.error)return c;n.param=j.getParams(u[1])}l=u[0];let h=l.split("/"),a=[];for(let c=0;c<h.length;c++)h[c]!==""&&a.push(h[c]);if(a.length===1)n.location[0]=a[0],n.location[1]=0;else{let c=a.pop(),s=parseInt(c);if(isNaN(s))return{error:"block number error"};n.location[1]=s,n.location[0]=a.join("/")}return n}});var ir=I(($r,ar)=>{(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(r,t){return r<<t|r>>>32-t},rotr:function(r,t){return r<<32-t|r>>>t},endian:function(r){if(r.constructor==Number)return n.rotl(r,8)&16711935|n.rotl(r,24)&4278255360;for(var t=0;t<r.length;t++)r[t]=n.endian(r[t]);return r},randomBytes:function(r){for(var t=[];r>0;r--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(r){for(var t=[],i=0,l=0;i<r.length;i++,l+=8)t[l>>>5]|=r[i]<<24-l%32;return t},wordsToBytes:function(r){for(var t=[],i=0;i<r.length*32;i+=8)t.push(r[i>>>5]>>>24-i%32&255);return t},bytesToHex:function(r){for(var t=[],i=0;i<r.length;i++)t.push((r[i]>>>4).toString(16)),t.push((r[i]&15).toString(16));return t.join("")},hexToBytes:function(r){for(var t=[],i=0;i<r.length;i+=2)t.push(parseInt(r.substr(i,2),16));return t},bytesToBase64:function(r){for(var t=[],i=0;i<r.length;i+=3)for(var l=r[i]<<16|r[i+1]<<8|r[i+2],u=0;u<4;u++)i*8+u*6<=r.length*8?t.push(e.charAt(l>>>6*(3-u)&63)):t.push("=");return t.join("")},base64ToBytes:function(r){r=r.replace(/[^A-Z0-9+\/]/ig,"");for(var t=[],i=0,l=0;i<r.length;l=++i%4)l!=0&&t.push((e.indexOf(r.charAt(i-1))&Math.pow(2,-2*l+8)-1)<<l*2|e.indexOf(r.charAt(i))>>>6-l*2);return t}};ar.exports=n})()});var q=I((jr,ur)=>{var G={utf8:{stringToBytes:function(e){return G.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(G.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var n=[],r=0;r<e.length;r++)n.push(e.charCodeAt(r)&255);return n},bytesToString:function(e){for(var n=[],r=0;r<e.length;r++)n.push(String.fromCharCode(e[r]));return n.join("")}}};ur.exports=G});var sr=I((Gr,cr)=>{cr.exports=function(e){return e!=null&&(lr(e)||Ir(e)||!!e._isBuffer)};function lr(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function Ir(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&lr(e.slice(0,0))}});var V=I((qr,fr)=>{(function(){var e=ir(),n=q().utf8,r=sr(),t=q().bin,i=function(l,u){l.constructor==String?u&&u.encoding==="binary"?l=t.stringToBytes(l):l=n.stringToBytes(l):r(l)?l=Array.prototype.slice.call(l,0):!Array.isArray(l)&&l.constructor!==Uint8Array&&(l=l.toString());for(var o=e.bytesToWords(l),h=l.length*8,a=1732584193,c=-271733879,s=-1732584194,f=271733878,p=0;p<o.length;p++)o[p]=(o[p]<<8|o[p]>>>24)&16711935|(o[p]<<24|o[p]>>>8)&4278255360;o[h>>>5]|=128<<h%32,o[(h+64>>>9<<4)+14]=h;for(var d=i._ff,v=i._gg,g=i._hh,y=i._ii,p=0;p<o.length;p+=16){var w=a,O=c,N=s,_=f;a=d(a,c,s,f,o[p+0],7,-680876936),f=d(f,a,c,s,o[p+1],12,-389564586),s=d(s,f,a,c,o[p+2],17,606105819),c=d(c,s,f,a,o[p+3],22,-1044525330),a=d(a,c,s,f,o[p+4],7,-176418897),f=d(f,a,c,s,o[p+5],12,1200080426),s=d(s,f,a,c,o[p+6],17,-1473231341),c=d(c,s,f,a,o[p+7],22,-45705983),a=d(a,c,s,f,o[p+8],7,1770035416),f=d(f,a,c,s,o[p+9],12,-1958414417),s=d(s,f,a,c,o[p+10],17,-42063),c=d(c,s,f,a,o[p+11],22,-1990404162),a=d(a,c,s,f,o[p+12],7,1804603682),f=d(f,a,c,s,o[p+13],12,-40341101),s=d(s,f,a,c,o[p+14],17,-1502002290),c=d(c,s,f,a,o[p+15],22,1236535329),a=v(a,c,s,f,o[p+1],5,-165796510),f=v(f,a,c,s,o[p+6],9,-1069501632),s=v(s,f,a,c,o[p+11],14,643717713),c=v(c,s,f,a,o[p+0],20,-373897302),a=v(a,c,s,f,o[p+5],5,-701558691),f=v(f,a,c,s,o[p+10],9,38016083),s=v(s,f,a,c,o[p+15],14,-660478335),c=v(c,s,f,a,o[p+4],20,-405537848),a=v(a,c,s,f,o[p+9],5,568446438),f=v(f,a,c,s,o[p+14],9,-1019803690),s=v(s,f,a,c,o[p+3],14,-187363961),c=v(c,s,f,a,o[p+8],20,1163531501),a=v(a,c,s,f,o[p+13],5,-1444681467),f=v(f,a,c,s,o[p+2],9,-51403784),s=v(s,f,a,c,o[p+7],14,1735328473),c=v(c,s,f,a,o[p+12],20,-1926607734),a=g(a,c,s,f,o[p+5],4,-378558),f=g(f,a,c,s,o[p+8],11,-2022574463),s=g(s,f,a,c,o[p+11],16,1839030562),c=g(c,s,f,a,o[p+14],23,-35309556),a=g(a,c,s,f,o[p+1],4,-1530992060),f=g(f,a,c,s,o[p+4],11,1272893353),s=g(s,f,a,c,o[p+7],16,-155497632),c=g(c,s,f,a,o[p+10],23,-1094730640),a=g(a,c,s,f,o[p+13],4,681279174),f=g(f,a,c,s,o[p+0],11,-358537222),s=g(s,f,a,c,o[p+3],16,-722521979),c=g(c,s,f,a,o[p+6],23,76029189),a=g(a,c,s,f,o[p+9],4,-640364487),f=g(f,a,c,s,o[p+12],11,-421815835),s=g(s,f,a,c,o[p+15],16,530742520),c=g(c,s,f,a,o[p+2],23,-995338651),a=y(a,c,s,f,o[p+0],6,-198630844),f=y(f,a,c,s,o[p+7],10,1126891415),s=y(s,f,a,c,o[p+14],15,-1416354905),c=y(c,s,f,a,o[p+5],21,-57434055),a=y(a,c,s,f,o[p+12],6,1700485571),f=y(f,a,c,s,o[p+3],10,-1894986606),s=y(s,f,a,c,o[p+10],15,-1051523),c=y(c,s,f,a,o[p+1],21,-2054922799),a=y(a,c,s,f,o[p+8],6,1873313359),f=y(f,a,c,s,o[p+15],10,-30611744),s=y(s,f,a,c,o[p+6],15,-1560198380),c=y(c,s,f,a,o[p+13],21,1309151649),a=y(a,c,s,f,o[p+4],6,-145523070),f=y(f,a,c,s,o[p+11],10,-1120210379),s=y(s,f,a,c,o[p+2],15,718787259),c=y(c,s,f,a,o[p+9],21,-343485551),a=a+w>>>0,c=c+O>>>0,s=s+N>>>0,f=f+_>>>0}return e.endian([a,c,s,f])};i._ff=function(l,u,o,h,a,c,s){var f=l+(u&o|~u&h)+(a>>>0)+s;return(f<<c|f>>>32-c)+u},i._gg=function(l,u,o,h,a,c,s){var f=l+(u&h|o&~h)+(a>>>0)+s;return(f<<c|f>>>32-c)+u},i._hh=function(l,u,o,h,a,c,s){var f=l+(u^o^h)+(a>>>0)+s;return(f<<c|f>>>32-c)+u},i._ii=function(l,u,o,h,a,c,s){var f=l+(o^(u|~h))+(a>>>0)+s;return(f<<c|f>>>32-c)+u},i._blocksize=16,i._digestsize=16,fr.exports=function(l,u){if(l==null)throw new Error("Illegal argument "+l);var o=e.wordsToBytes(i(l,u));return u&&u.asBytes?o:u&&u.asString?t.bytesToString(o):e.bytesToHex(o)}})()});var pr={};S(pr,{checkAuth:()=>Er,checkTrust:()=>Rr,easyAuth:()=>Fr});var hr,Fr,Er,Rr,dr=P(()=>{"use strict";hr=V(),Fr=(e,n,r)=>{},Er=(e,n,r)=>{let t={list:null,anchor:null};return n.auth?typeof n.auth=="string"||Array.isArray(n.auth)?t.anchor=n.auth:t.list=n.auth:n.salt&&(t.anchor=hr(e+n.salt[0])),r&&r(t)},Rr=(e,n,r)=>{let t={list:null,anchor:null};return n.trust?typeof n.trust=="string"||Array.isArray(n.trust)?t.anchor=n.trust:t.list=n.trust:n.salt&&(t.anchor=hr(e+n.salt[0])),r&&r(t)}});var gr={};S(gr,{checkHide:()=>Sr,easyHide:()=>Pr});var Cr,Pr,Sr,vr=P(()=>{"use strict";Cr=V(),Pr=e=>{},Sr=(e,n,r)=>{let t={list:null,anchor:null};return n.hide?typeof n.hide=="string"?t.anchor=n.hide:Array.isArray(n.hide)&&(t.list=n.hide):n.salt&&(t.anchor=Cr(e+n.salt[1])),r&&r(t)}});var yr=I(U=>{var W=null,X=null,L={getLibs:(e,n,r,t)=>{r||(r={}),t||(t=[]);let i=e.shift(),l=(Array.isArray(i)?i[0]:i).toLocaleLowerCase(),u=Array.isArray(i)?i[1]:0;if(r[l])return L.getLibs(e,n,r,t);L.getAnchor(l,u,(o,h)=>{if(r[o]=h||{error:"no such anchor"},!h.protocol||!h.protocol.ext&&!h.protocol.lib)t.push(o);else{let a={entry:o,lib:h.protocol&&h.protocol.lib?h.protocol.lib:[],ext:h.protocol&&h.protocol.ext?h.protocol.ext:[]};t.push(a)}if(h.protocol&&h.protocol.ext)for(let a=h.protocol.ext.length;a>0;a--)e.unshift(h.protocol.ext[a-1]);if(h.protocol&&h.protocol.lib)for(let a=h.protocol.lib.length;a>0;a--)e.unshift(h.protocol.lib[a-1]);if(e.length===0)return n&&n(r,t);L.getLibs(e,n,r,t)})},getAnchor:(e,n,r)=>{if(!e)return r&&r(e,"");(n===0?W:X)(e,i=>{if(!i||!i.owner)return r&&r(e,"");if(!i.empty)return r&&r(e,i)})},decodeLib:e=>{let n={type:"error",data:""};if(e.error)return n.error=e.error,n;if(!e.protocol)return n.error="Unexcept data format",n;let r=e.protocol;return r.fmt?(n.type=r.fmt,e.raw.substr(0,2).toLowerCase()==="0x"?n.data=L.decodeUTF8(e.raw):n.data=e.raw,n):(n.error="Anchor format lost",n)},decodeUTF8:e=>{e.substr(0,2).toLowerCase()==="0x"&&(e=tr.slice(2));let n=e.replace(/\s+/g,"").split(""),r="";for(let t=0;t<n.length;t+=2)r+="%"+n[t]+n[t+1];return decodeURIComponent(r)},getComplexOrder:(e,n,r,t)=>{if(r||(r=[]),t||(t=[]),n[e]===!0&&t.length===0)return r;let i=n[e],l=t.length!==0?t[t.length-1]:null,u=l!==null&&l.name===e?t.pop():null;if(i.lib&&i.lib.length>0){if(u===null)for(let o=0;o<i.lib.length;o++){let h=i.lib[o];if(n[h]===!0)r.push(h);else return t.push({lib:o,name:e}),L.getComplexOrder(h,n,r,t)}else if(u.lib!==void 0&&u.lib!==i.lib.length)for(let o=u.lib+1;o<i.lib.length;o++){let h=i.lib[o];if(n[h]===!0)r.push(h);else return t.push({lib:o,name:e}),L.getComplexOrder(h,n,r,t)}}if(u===null&&r.push(e),i.ext&&i.ext.length>0)if(u!==null){if(u.ext!==void 0&&u.ext!==i.ext.length)for(let o=u.ext+1;o<i.ext.length;o++){let h=i.ext[o];if(n[h]===!0)r.push(h);else return t.push({ext:o,name:e}),L.getComplexOrder(h,n,r,t)}}else for(let o=0;o<i.ext.length;o++){let h=i.ext[o];if(n[h]===!0)r.push(h);else return t.push({ext:o,name:e}),L.getComplexOrder(h,n,r,t)}if(t.length!==0){let o=t[t.length-1];return L.getComplexOrder(o.name,n,r,t)}return r},mergeOrder:e=>{let n={},r={},t={},i=[];for(let l=0;l<e.length;l++){let u=e[l];typeof u!="string"&&u.entry!==void 0?(n[u.entry]=!0,r[u.entry]=u):r[u]=!0}for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"||u instanceof String){if(t[u])continue;i.push(u),t[u]=!0}else{if(u.lib&&u.lib.length>0)for(let o=0;o<u.lib.length;o++){let h=u.lib[o];if(!t[h])if(n[h]){let a=L.getComplexOrder(h,r);for(let c=0;c<a.length;c++){let s=a[c];t[s]||(i.push(s),t[s]=!0)}}else i.push(h),t[h]=!0}if(t[u.entry]||(i.push(u.entry),t[u.entry]=!0),u.ext&&u.ext.length>0)for(let o=0;o<u.ext.length;o++){let h=u.ext[o];if(!t[h])if(n[h]){let a=L.getComplexOrder(h,r);for(let c=0;c<a.length;c++){let s=a[c];t[s]||(i.push(s),t[s]=!0)}}else i.push(h),t[h]=!0}}}return i},regroupCode:(e,n)=>{let r=L.decodeLib,t="",i="",l={},u={},o=!1,h=L.mergeOrder(n);for(let a=0;a<h.length;a++){let c=h[a];if(l[c])continue;let s=e[c],f=r(s);if(l[c]=!0,f.error){u[c]=f.error,o=!0;continue}t+=f.type==="js"?f.data:"",i+=f.type==="css"?f.data:""}return{js:t,css:i,failed:u,order:h,error:o}}};U.Loader=(e,n,r)=>{W=n.search,X=n.target,L.getLibs(e,r)};U.Group=L.regroupCode;U.Libs=(e,n,r)=>{W=n.search,X=n.target,L.getLibs(e,(t,i)=>{let l=L.regroupCode(t,i);return r&&r(l)})}});var Mr=I(H=>{Object.defineProperty(H,"__esModule",{value:!0});H.easyRun=void 0;var m=($(),R(J)),A=($(),R(J)),D=(or(),R(er)),xr=(dr(),R(pr)),Br=(vr(),R(gr)),mr=yr(),br=mr.Group,Ur=mr.Loader,b=null,T={disable:!1,cache:!0,search:[],start:0,end:0,stamp:function(){return new Date().getTime()}},E={data:{},set:function(e,n,r){return E.data["".concat(e,"_").concat(n)]=r,!0},get:function(e,n){return E.data["".concat(e,"_").concat(n)]},clear:function(){E.data={}}},x={getAnchor:function(e,n){if(b===null)return n&&n({error:"No API to get data.",level:m.errorLevel.ERROR});var r=e[0],t=e[1];if(!T.cache){var i=E.get(r,t);if(i!==void 0)return n&&n(i)}t!==0?b.common.target(r,t,function(l){x.filterAnchor(l,n)}):b.common.latest(r,function(l){x.filterAnchor(l,n)})},filterAnchor:function(e,n){if(!e)return n&&n({error:"No such anchor.",level:m.errorLevel.ERROR});var r=e;if(r.error)return n&&n({error:r.error,level:m.errorLevel.ERROR});var t=e;if(T.disable||T.search.push([t.name,t.block]),T.cache||E.set(t.name,t.block,t),t.empty)return n&&n({error:"Empty anchor.",level:m.errorLevel.ERROR});if(!t.protocol)return n&&n({error:"No-protocol anchor."});var i=t.protocol;return i.type?n&&n(t):n&&n({error:"Not EasyProtocol anchor."})},decodeData:function(e,n){e.type=m.rawType.DATA;var r=e.data["".concat(e.location[0],"_").concat(e.location[1])],t=r.protocol;return t!==null&&t.call&&(e.call=t.call),n&&n(e)},decodeApp:function(e,n){e.type=m.rawType.APP;var r=e.data["".concat(e.location[0],"_").concat(e.location[1])],t=r.protocol;if(e.code=r.raw,t!==null&&t.res&&(e.resource=t.res),t!==null&&t.lib)x.getLibs(t.lib,function(i,l){var u=br(i,l),o={};for(var h in i){var a=i[h];a.name!==void 0&&(e.data["".concat(a.name,"_").concat(a.block)]=a,o[a.name]=[a.name,a.block])}if(u.order.length!==0){for(var c=[],s=0;s<u.order.length;s++){var f=u.order[s];o[f]!==void 0&&c.push(o[f])}u.order=c}return e.libs=u,n&&n(e)});else return n&&n(e)},decodeLib:function(e,n){e.type=m.rawType.LIB;var r=e.data["".concat(e.location[0],"_").concat(e.location[1])],t=r.protocol;if(t!==null&&t.lib)x.getLibs(t.lib,function(i,l){var u=br(i,l),o={};for(var h in i){var a=i[h];a.name!==void 0&&(e.data["".concat(a.name,"_").concat(a.block)]=a,o[a.name]=[a.name,a.block])}if(u.order.length!==0){for(var c=[],s=0;s<u.order.length;s++){var f=u.order[s];o[f]!==void 0&&c.push(o[f])}u.order=c}return e.libs=u,n&&n(e)});else return n&&n(e)},formatLibs:function(){},getLibs:function(e,n){if(b===null)return n&&n({error:"No API to get data.",level:m.errorLevel.ERROR});var r={search:b.common.latest,target:b.common.target};Ur(e,r,n)},getHistory:function(e,n){var r=[],t=[];if(b===null)return t.push({error:"No API to get data.",level:m.errorLevel.ERROR}),n&&n(r,t);var i=e[0],l=e[1];b.common.history(i,function(u){var o=u;if(o.error)return t.push(o),n&&n(r,t);var h=u;return h.length===0?(t.push({error:"Empty history"}),n&&n(r,t)):n&&n(h,t)})},merge:function(e,n,r){if(b===null)return r&&r({error:"No API to get data.",level:m.errorLevel.ERROR});var t={hide:[],auth:null,trust:null,error:[],index:[null,null,null],map:{}};x.singleRule(e,n,A.relatedIndex.HIDE,function(i,l,u,o){var h;u!==null&&(t.index[A.relatedIndex.HIDE]=u);for(var a in l)t.map[a]=l[a];o.length!==0&&(h=t.error).push.apply(h,o),t.hide=i,x.singleRule(e,n,A.relatedIndex.AUTH,function(c,s,f,p){var d;f!==null&&(t.index[A.relatedIndex.AUTH]=f);for(var v in s)t.map[v]=s[v];p.length!==0&&(d=t.error).push.apply(d,p),t.auth=c,x.singleRule(e,n,A.relatedIndex.TRUST,function(g,y,w,O){var N;w!==null&&(t.index[A.relatedIndex.TRUST]=w);for(var _ in y)t.map[_]=y[_];return O.length!==0&&(N=t.error).push.apply(N,O),t.trust=g,r&&r(t)})})})},singleRule:function(e,n,r,t){var i=null,l={},u=null,o=[];switch(r){case A.relatedIndex.HIDE:(0,Br.checkHide)(e,n,function(h){if(h.anchor===null&&h.list!==null)return i=h.list,t&&t(i,l,u,o);if(h.anchor!==null&&h.list===null)x.singleExtend(h.anchor,!1,function(a,c,s){i=a;for(var f in c)l[f]=c[f];return o.push.apply(o,s),t&&t(i,l,u,o)});else return h.anchor!==null&&h.list!==null&&o.push({error:"Format error."}),t&&t(i,l,u,o)});break;case A.relatedIndex.AUTH:(0,xr.checkAuth)(e,n,function(h){if(h.anchor===null&&h.list!==null)return i=h.list,t&&t(i,l,u,o);if(h.anchor!==null&&h.list===null)x.singleExtend(h.anchor,!0,function(a,c,s){i=a;for(var f in c)l[f]=c[f];return o.push.apply(o,s),t&&t(i,l,u,o)});else return h.anchor!==null&&h.list!==null&&o.push({error:"Format error."}),t&&t(i,l,u,o)});break;case A.relatedIndex.TRUST:(0,xr.checkTrust)(e,n,function(h){if(h.anchor===null&&h.list!==null)return i=h.list,t&&t(i,l,u,o);if(h.anchor!==null&&h.list===null)x.singleExtend(h.anchor,!0,function(a,c,s){i=a;for(var f in c)l[f]=c[f];return o.push.apply(o,s),t&&t(i,l,u,o)});else return h.anchor!==null&&h.list!==null&&o.push({error:"Format error."}),t&&t(i,l,u,o)});break;default:o.push({error:"unknow related index."}),t&&t(i,l,u,o);break}},singleExtend:function(e,n,r){var t=null,i={},l=[],u=Array.isArray(e)?[e[0],0]:[e,0];n?x.getLatestDeclaredHidden(u,function(o,h){var a=o;a!==void 0&&a.error&&l.push(a),h!==void 0&&(i["".concat(h.name,"_").concat(h.block)]=h);var c=o,s={};if(Array.isArray(c))for(var f=0;f<c.length;f++)s[c[f]]=!0;x.getHistory([Array.isArray(e)?e[0]:e,0],function(p,d){d!==void 0&&l.push.apply(l,d);for(var v=0;v<p.length;v++){var g=p[v];if(i["".concat(g.name,"_").concat(g.block)]=g,!s[g.block]){if(!g.protocol||!g.raw||g.protocol.type!==m.rawType.DATA){l.push({error:"Not valid anchor. ".concat(g.name,":").concat(g.block)});continue}try{var y=JSON.parse(g.raw);t===null&&(t={});for(var w in y)t[w]=y[w]}catch{l.push({error:"JSON format failed. ".concat(g.name,":").concat(g.block)});continue}}}return r&&r(t,i,l)})}):x.getAnchor(Array.isArray(e)?e:[e,0],function(o){var h=o;if(h!==void 0&&h.error)return l.push(h),r&&r(t,i,l);var a=o;if(i["".concat(a.name,"_").concat(a.block)]=a,!a.protocol||!a.raw||a.protocol.type!==m.rawType.DATA)return l.push({error:"Not valid anchor."}),r&&r(t,i,l);try{return t=JSON.parse(a.raw),r&&r(t,i,l)}catch(c){return l.push({error:JSON.stringify(c)}),r&&r(t,i,l)}})},decodeHideAnchor:function(e){var n=[],r=e.protocol;if(r?.fmt==="json")try{var t=JSON.parse(e.raw);if(Array.isArray(t))for(var i=0;i<t.length;i++){var l=parseInt(t[i]);isNaN(l)||n.push(l)}}catch{return{error:"failed to parse JSON"}}return n},checkAuthority:function(e,n,r){if(n.type!==m.rawType.APP)return e.error.push({error:"Answer is not cApp."}),r&&r(e);var t=e.data["".concat(e.location[0],"_").concat(e.location[1])],i=t.signer,l=n.auth;if(l===void 0)return e.app=n,r&&r(e);if(x.empty(l))return e.app=n,r&&r(e);if(l[i]===void 0)return e.error.push({error:"No authority of caller."}),r&&r(e);if(l[i]===0)return e.app=n,r&&r(e);b?.common.block(function(u,o){return u>l[i]?(e.error.push({error:"Authority out of time."}),r&&r(e)):(e.app=n,r&&r(e))})},getLatestDeclaredHidden:function(e,n){x.getAnchor([e[0],0],function(r){var t=r;if(t.error)return n&&n([]);var i=r,l=i.protocol;if(l===null||!l.hide)return n&&n([]);if(Array.isArray(l.hide))return n&&n(l.hide);x.getAnchor([l.hide,0],function(u){var o=r;if(o.error)return n&&n([]);var h=u;if(h===null||!h.raw)return n&&n([],h);try{var a=JSON.parse(h.raw);return n&&n(a,h)}catch(c){return n&&n({error:c})}})})},isValidAnchor:function(e,n,r,t){var i=[],l=n.block,u=!1;if(Array.isArray(e)){for(var o=e,h=0;h<o.length;h++)if(l===o[h]){if(n.pre===0)return i.push({error:"Out of ".concat(n.name," limited")}),u=!0,r&&r(null,i,u);var a=(0,D.linkCreator)([n.name,n.pre],t);return r&&r(a,i,u)}return r&&r(null,i)}else{var c=[e,0];x.getAnchor(c,function(s){var f=x.decodeHideAnchor(s),p=f;p.error&&i.push(p);for(var d=f,v=0;v<d.length;v++)if(l===d[v]){if(n.pre===0)return i.push({error:"Out of ".concat(n.name," limited")}),u=!0,r&&r(null,i,u);var g=(0,D.linkCreator)([n.name,n.pre],t);return r&&r(g,i,u)}return r&&r(null,i,u)})}},getParams:function(e){for(var n={},r=e.split("&"),t=0;t<r.length;t++){var i=r[t],l=i.split("=");if(l.length!==2)return{error:"error parameter"};n[l[0]]=l[1]}return n},empty:function(e){for(var n in e)return!1;return!0}},C={};C[m.rawType.APP]=x.decodeApp;C[m.rawType.DATA]=x.decodeData;C[m.rawType.LIB]=x.decodeLib;var F=function(e,n,r,t,i){b===null&&n!==null&&(b=n);var l=(0,D.linkDecoder)(e);if(l.error)return r&&r(l);if(t===void 0)return x.getLatestDeclaredHidden(l.location,function(o,h){var a={type:m.rawType.NONE,location:[l.location[0],l.location[1]!==0?l.location[1]:0],error:[],data:{},index:[null,null,null]},c=o;if(c!==void 0&&c.error)return a.error.push(c),F(e,b,r,[]);var s=o;return F(e,b,r,s)});var u={type:m.rawType.NONE,location:[l.location[0],l.location[1]!==0?l.location[1]:0],error:[],data:{},index:[null,null,null],hide:t};l.param&&(u.parameter=l.param),x.getAnchor(l.location,function(o){var h=o;if(h.error)return u.error.push(h),r&&r(u);var a=o;if(u.location[1]===0&&(u.location[1]=a.block),u.data["".concat(u.location[0],"_").concat(u.location[1])]=a,a.protocol===null)return u.error.push({error:"No valid protocol"}),r&&r(u);var c=a.protocol.type?a.protocol.type:"";if(!C[c])return u.error.push({error:"Not easy protocol type"}),r&&r(u);if(a.protocol)x.isValidAnchor(t,a,function(p,d,v){var g;return(g=u.error).push.apply(g,d),v?r&&r(u):p!==null?F(p,b,r,t):f(c)},u.parameter===void 0?{}:u.parameter);else return f(c);function s(p,d,v){if(p.call&&!v){var g=(0,D.linkCreator)(p.call,p.parameter===void 0?{}:p.parameter);return F(g,b,function(y){return x.checkAuthority(p,y,d)},t,!0)}else return d&&d(p)}function f(p){x.merge(a.name,a.protocol,function(d){var v;d.auth!==null&&(u.auth=d.auth),d.trust!==null&&(u.trust=d.trust),d.hide!=null&&d.hide.length!==0&&(u.hide=d.hide),d.error.length!==0&&(v=u.error).push.apply(v,d.error),d.index[A.relatedIndex.AUTH]!==null&&u.index&&(u.index[A.relatedIndex.AUTH]=d.index[A.relatedIndex.AUTH]),d.index[A.relatedIndex.HIDE]!==null&&u.index&&(u.index[A.relatedIndex.HIDE]=d.index[A.relatedIndex.HIDE]),d.index[A.relatedIndex.TRUST]!==null&&u.index&&(u.index[A.relatedIndex.TRUST]=d.index[A.relatedIndex.TRUST]);for(var g in d.map)u.data[g]=d.map[g];return C[p](u,function(y){if(y.resource)x.getAnchor([y.resource,0],function(w){var O=w;if(O.error)return u.error.push(O),s(y,r,i);var N=w;if(y.data["".concat(N.name,"_").concat(N.block)]=N,N.raw!==null){var _=JSON.parse(N.raw);b!==null&&b.common.multi!==void 0&&b.common.multi(_,function(z){var K=z;if(K.error)return u.error.push(K),r&&r(y);var Ar=z;return y.raw=Ar,s(y,r,i)})}});else return s(y,r,i)})})}})},Dr=function(e,n,r){T.search=[],T.start=T.stamp(),F(e,n,function(t){return T.disable||(t.debug=T),T.end=T.stamp(),E.clear(),r&&r(t)})},Hr=T.disable?F:Dr;H.easyRun=Hr});return Mr();})();
//!important This is the Typescript implement of Esay Protocol version 1.0.
//!important Easy Protocol is a simple protocol to launch cApp via Anchor network.
//!important All functions implement, but this implement only support JS with CSS application 
//!important this is not part of easy protocol, develop can limit the function freely
//!important This is the library for decoding anchor link
//!important 3 format of anchor linker. The "/" is optional.
//!important `anchor://${anchor}/${block}[/]`;
//!important `anchor://${anchor}[/]`;
//!important `anchor://${anchor}/${block}[/]?${key_1}=${value_1}&${key_2}=${value_2}`;
//!important This is the library for creating auth data
//!important This is the library for Esay Protocol v1.0
//!important All data come from `Anchor Link`
//!important This implement extend `auth` and `hide` by salt way to load data
//!important, as support `declared hidden`, this function may redirect many times, be careful.
/*! Bundled license information:

is-buffer/index.js:
  (*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/
