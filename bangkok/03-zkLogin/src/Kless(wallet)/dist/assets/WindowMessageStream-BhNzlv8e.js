import{z as E,e as w,n as g,i as y,O as L,j as s,f as v,m as c,s as M,a as l}from"./Message-BmumhDZC.js";import{m as O}from"./mergeMap-CRZcgDlV.js";var _=["addListener","removeListener"],b=["addEventListener","removeEventListener"],T=["on","off"];function m(e,r,n,t){if(s(n)&&(t=n,n=void 0),t)return m(e,r,n).pipe(E(t));var a=w(q(e)?b.map(function(i){return function(o){return e[i](r,o,n)}}):W(e)?_.map(h(e,r)):j(e)?T.map(h(e,r)):[],2),f=a[0],p=a[1];if(!f&&g(e))return O(function(i){return m(i,r,n)})(y(e));if(!f)throw new TypeError("Invalid event target");return new L(function(i){var o=function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];return i.next(1<u.length?u:u[0])};return f(o),function(){return p(o)}})}function h(e,r){return function(n){return function(t){return e[n](r,t)}}}function W(e){return s(e.addListener)&&s(e.removeListener)}function j(e){return s(e.on)&&s(e.off)}function q(e){return s(e.addEventListener)&&s(e.removeEventListener)}class F{constructor(r,n){if(r===n)throw new Error("[WindowMessageStream] name and target must be different");this._name=r,this._target=n,this.messages=m(window,"message").pipe(v(t=>t.source===window&&t.data.target===this._name),c(t=>t.data.payload),M())}send(r){const n={target:this._target,payload:r};window.postMessage(n)}sendRequest(r,n){const t=l(r,n);return this.send(t),this.messages.pipe(v(({id:a})=>a===t.id),c(a=>a.payload))}}export{F as W};
